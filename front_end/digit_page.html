<style>
  body {
    background: #111;
    color: white;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding-top: 20px;
  }

  #canvas {
    border: 2px solid #444;
    border-radius: 8px;
    cursor: crosshair;
  }

  #predict {
    padding: 8px 16px;
    border: none;
    background: #333;
    color: white;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
  }
  #predict:hover {
    background: #555;
  }
</style>

<canvas id="canvas" width="280" height="280"></canvas>
<button id="predict">Predict</button>
<p id="result"></p>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let drawing = false;
let hasDrawn = false; // Track if canvas should be cleared on next draw

// ----- Setup black background -----
function resetCanvas() {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}
resetCanvas();

// ----- Drawing Logic -----
canvas.addEventListener('mousedown', e => {
  drawing = true;

  // If there's existing drawing, clear when starting a new stroke
  if (hasDrawn) {
    resetCanvas();
  }

  hasDrawn = true;

  ctx.beginPath();
  ctx.moveTo(e.offsetX, e.offsetY);
});

canvas.addEventListener('mouseup', () => {
  drawing = false;
});

canvas.addEventListener('mousemove', e => {
  if (!drawing) return;

  ctx.lineWidth = 20;
  ctx.lineCap = "round";
  ctx.strokeStyle = "white";

  ctx.lineTo(e.offsetX, e.offsetY);
  ctx.stroke();
});

// ----- Predict Button -----
document.getElementById('predict').addEventListener('click', async () => {
  const dataUrl = canvas.toDataURL('image/png');

  const response = await fetch(
    'https://personal-website-40217740204.europe-west1.run.app/digit-predict',
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ image: dataUrl })
    }
  );

  const result = await response.json();
  document.getElementById('result').innerText = `Prediction: ${result.digit}`;
});
</script>

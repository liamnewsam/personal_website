<style>
  body {
    margin: 0;
    background: #111;
    color: white;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 20px 0;
  }

  #canvas-container {
    width: 90vw;               /* responsive width */
    max-width: 420px;          /* limit size on large screens */
    aspect-ratio: 1 / 1;       /* always a perfect square */
    border: 2px solid #444;
    border-radius: 8px;
  }

  #canvas {
    width: 100%;
    height: 100%;
    touch-action: none;         /* disable scroll/pinch while drawing */
    display: block;
  }

  button {
    padding: 10px 18px;
    border: none;
    background: #333;
    color: white;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
    margin: 4px;
  }

  button:hover {
    background: #555;
  }
</style>

<div id="canvas-container">
  <canvas id="canvas" width="280" height="280"></canvas>
</div>

<div>
  <button id="predict">Predict</button>
  <button id="erase">Erase</button>
</div>

<p id="result"></p>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let drawing = false;

// ------------------ INITIAL BLACK BACKGROUND ------------------
function resetCanvas() {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}
resetCanvas();

// ------------------ DRAWING HELPERS ------------------
function getPos(e) {
  if (e.touches) {
    const rect = canvas.getBoundingClientRect();
    return {
      x: (e.touches[0].clientX - rect.left) * (canvas.width / rect.width),
      y: (e.touches[0].clientY - rect.top) * (canvas.height / rect.height)
    };
  }
  return { x: e.offsetX, y: e.offsetY };
}

function startDraw(e) {
  e.preventDefault();       // stop scrolling
  drawing = true;

  const { x, y } = getPos(e);
  ctx.beginPath();
  ctx.moveTo(x, y);
}

function moveDraw(e) {
  if (!drawing) return;

  const { x, y } = getPos(e);

  ctx.lineWidth = 20;
  ctx.lineCap = "round";
  ctx.strokeStyle = "white";

  ctx.lineTo(x, y);
  ctx.stroke();
}

function endDraw() {
  drawing = false;
}

// ------------------ MOUSE EVENTS ------------------
canvas.addEventListener('mousedown', startDraw);
canvas.addEventListener('mousemove', moveDraw);
canvas.addEventListener('mouseup', endDraw);
canvas.addEventListener('mouseleave', endDraw);

// ------------------ TOUCH EVENTS ------------------
canvas.addEventListener('touchstart', startDraw, { passive: false });
canvas.addEventListener('touchmove', moveDraw, { passive: false });
canvas.addEventListener('touchend', endDraw);
canvas.addEventListener('touchcancel', endDraw);

// ------------------ ERASE BUTTON ------------------
document.getElementById('erase').addEventListener('click', resetCanvas);

// ------------------ PREDICT BUTTON ------------------
document.getElementById('predict').addEventListener('click', async () => {
  const dataUrl = canvas.toDataURL('image/png');

  const response = await fetch(
    'https://personal-website-40217740204.europe-west1.run.app/digit-predict',
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ image: dataUrl })
    }
  );

  const result = await response.json();
  document.getElementById('result').innerText = `Prediction: ${result.digit}`;
});
</script>


<style>
  body {
    margin: 0;
    background: #111;
    color: white;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 20px 0;
  }

  #canvas-container {
    width: 90vw;               /* much bigger on mobile */
    max-width: 480px;          /* nice size on desktop */
    aspect-ratio: 1 / 1;
    border: 2px solid #444;
    border-radius: 8px;
  }

  #canvas {
    width: 100%;
    height: 100%;
    touch-action: none;
    display: block;
  }

  button {
    padding: 10px 18px;
    border: none;
    background: #333;
    color: white;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
    margin: 4px;
  }
  button:hover {
    background: #555;
  }
</style>

<div id="canvas-container">
  <!-- INTERNAL resolution is much bigger -->
  <canvas id="canvas" width="600" height="600"></canvas>
</div>

<div>
  <button id="predict">Predict</button>
  <button id="erase">Erase</button>
</div>

<p id="result"></p>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let drawing = false;

// ------------------ INITIAL BLACK BACKGROUND ------------------
function resetCanvas() {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}
resetCanvas();

// ------------------ POSITION HELPERS ------------------
function getPos(e) {
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;

  if (e.touches) {
    return {
      x: (e.touches[0].clientX - rect.left) * scaleX,
      y: (e.touches[0].clientY - rect.top) * scaleY
    };
  }

  return {
    x: e.offsetX * scaleX,
    y: e.offsetY * scaleY
  };
}

// ------------------ DRAWING EVENTS ------------------
function startDraw(e) {
  e.preventDefault();
  drawing = true;

  const { x, y } = getPos(e);
  ctx.beginPath();
  ctx.moveTo(x, y);
}

function moveDraw(e) {
  if (!drawing) return;

  const { x, y } = getPos(e);

  ctx.lineWidth = 40; // bigger brush for bigger canvas
  ctx.lineCap = "round";
  ctx.strokeStyle = "white";

  ctx.lineTo(x, y);
  ctx.stroke();
}

function endDraw() {
  drawing = false;
}

canvas.addEventListener('mousedown', startDraw);
canvas.addEventListener('mousemove', moveDraw);
canvas.addEventListener('mouseup', endDraw);
canvas.addEventListener('mouseleave', endDraw);

canvas.addEventListener('touchstart', startDraw, { passive: false });
canvas.addEventListener('touchmove', moveDraw, { passive: false });
canvas.addEventListener('touchend', endDraw);
canvas.addEventListener('touchcancel', endDraw);

// ------------------ ERASE BUTTON ------------------
document.getElementById('erase').addEventListener('click', resetCanvas);

// ------------------ PREDICT BUTTON ------------------
document.getElementById('predict').addEventListener('click', async () => {
  // STEP 1: Create downscaled 280Ã—280 canvas
  const small = document.createElement('canvas');
  small.width = 280;
  small.height = 280;
  const sctx = small.getContext('2d');

  sctx.drawImage(canvas, 0, 0, 280, 280);

  // STEP 2: Convert to PNG for backend
  const dataUrl = small.toDataURL('image/png');

  const response = await fetch(
    'https://personal-website-40217740204.europe-west1.run.app/digit-predict',
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ image: dataUrl })
    }
  );

  const result = await response.json();
  document.getElementById('result').innerText = `Prediction: ${result.digit}`;
});
</script>
